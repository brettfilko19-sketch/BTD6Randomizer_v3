<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BTD6 Ultimate CHIMPS Planner</title>
    <style>
        :root { --primary: #00d1b2; --bg-card: #1a1c23; --bg-body: #0b0e14; --border: #2d333b; }
        .coop-mode { --primary: #ffdd57; --border: #5d4d8a; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg-body); color: #e0e0e0; padding: 20px; transition: all 0.3s ease; }
        .container { max-width: 850px; margin: auto; background: var(--bg-card); padding: 25px; border-radius: 12px; border: 2px solid var(--border); box-shadow: 0 10px 40px rgba(0,0,0,0.6); }
        h2 { color: var(--primary); text-align: center; text-transform: uppercase; margin-bottom: 5px; }
        .subtitle { text-align: center; color: #7a7a7a; font-size: 0.85em; margin-bottom: 20px; }
        .coop-toggle-container { display: flex; justify-content: center; align-items: center; margin-bottom: 20px; padding: 10px; background: rgba(0,0,0,0.2); border-radius: 8px; }
        .coop-toggle-container label { color: #fff; margin-left: 10px; cursor: pointer; font-size: 0.9em; font-weight: bold; }
        .section-title { color: var(--primary); font-size: 0.8em; letter-spacing: 1px; margin: 20px 0 10px 0; border-bottom: 1px solid var(--border); padding-bottom: 5px; }
        label { display: block; margin-bottom: 5px; color: var(--primary); font-weight: bold; font-size: 0.9em; }
        select, input[type="number"] { width: 100%; padding: 10px; border-radius: 6px; background: #2d333b; color: white; border: 1px solid #3e444d; outline: none; box-sizing: border-box; margin-bottom: 10px; }
        .flex-row { display: flex; gap: 15px; margin-bottom: 10px; }
        .flex-row div { flex: 1; }
        .projector-box { background: rgba(0, 0, 0, 0.4); border: 1px solid var(--border); padding: 15px; border-radius: 8px; margin-bottom: 20px; }
        .projection-result { font-size: 1.3em; color: var(--primary); text-align: center; font-weight: bold; }
        .btn-random { width: 100%; padding: 15px; background: var(--primary); color: #0b0e14; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; margin-bottom: 20px; font-size: 1em; }
        .summary { background: #0b0e14; padding: 20px; border-radius: 10px; border-left: 5px solid var(--primary); }
        .total-box { font-size: 1.8em; text-align: center; margin-top: 10px; padding: 15px; border-radius: 8px; font-weight: bold; }
        .under-budget { border: 2px solid #00d1b2; color: #00d1b2; background: rgba(0, 209, 178, 0.05); }
        .over-budget { border: 2px solid #ff3860; color: #ff3860; background: rgba(255, 56, 96, 0.05); }
        .cost-row { display: flex; justify-content: space-between; border-bottom: 1px solid #2d333b; padding: 8px 0; font-size: 0.95em; }
    </style>
</head>
<body id="mainBody">

<div class="container">
    <h2>CHIMPS Strategy Planner</h2>
    <div class="subtitle" id="modeSubtitle">Single Player Mode</div>

    <div class="coop-toggle-container">
        <input type="checkbox" id="coopToggle" onchange="toggleCoop()">
        <label for="coopToggle">ðŸ‘¥ 3-Player Co-op (Me & Brother: 2/3 Total Share)</label>
    </div>

    <div class="section-title">FUTURE CASH PROJECTOR</div>
    <div class="projector-box">
        <div class="flex-row">
            <div><label>Current Cash</label><input type="number" id="curCash" value="0" oninput="updateUI()"></div>
            <div><label>Current Round</label><input type="number" id="curRound" value="6" min="6" max="100" oninput="updateUI()"></div>
            <div><label>Target Round</label><input type="number" id="futRound" value="100" min="6" max="100" oninput="updateUI()"></div>
        </div>
        <div id="projectionDisplay" class="projection-result">Projected: $0</div>
    </div>

    <button class="btn-random" onclick="rollRandom()">ðŸŽ² RANDOM T5 BUILD</button>

    <div class="input-group">
        <label>Hero Selection:</label>
        <select id="heroSelect" onchange="updateUI()"></select>
    </div>

    <div class="flex-row">
        <div><label>T5 Choice 1:</label><select id="tower1" onchange="updateUI()"></select></div>
        <div><label>T5 Choice 2:</label><select id="tower2" onchange="updateUI()"></select></div>
    </div>

    <div class="summary">
        <div id="priceReport"></div>
        <div id="totalDisplay" class="total-box">Total: $0</div>
        <div id="saveupAdvice" style="margin-top:15px; font-style: italic; color: #95a5a6; text-align: center;"></div>
    </div>
</div>

<script>
// EXACT CUMULATIVE EARNED CASH DATA (CHIMPS)
const ROUND_CASH = {
    6: 650, 7: 902, 8: 1222, 9: 1582, 10: 1914, 15: 3612, 20: 5546, 25: 7514, 30: 9706, 35: 12690, 
    40: 16400, 45: 21102, 50: 27076, 55: 34220, 60: 42426, 65: 52140, 70: 62410, 75: 76542, 
    80: 91104, 85: 110904, 90: 131754, 95: 157585, 100: 178909
};

// Interpolate the missing rounds for the data object
for(let i=6; i<=100; i++) {
    if(!ROUND_CASH[i]) {
        let prev = i-1; while(!ROUND_CASH[prev]) prev--;
        let next = i+1; while(!ROUND_CASH[next]) next++;
        let step = (ROUND_CASH[next] - ROUND_CASH[prev]) / (next - prev);
        ROUND_CASH[i] = Math.floor(ROUND_CASH[prev] + step);
    }
}

const DATA = {
    heroes: [{name:"Quincy", price:585},{name:"Gwen", price:970},{name:"Obyn", price:700},{name:"Churchill", price:2160},{name:"Ezili", price:650},{name:"Pat Fusty", price:865},{name:"Adora", price:1080},{name:"Brickell", price:970},{name:"Etienne", price:920},{name:"Sauda", price:650},{name:"Psi", price:1080},{name:"Geraldo", price:1325},{name:"Corvus", price:1325},{name:"Silas", price:1200},{name:"Rosalia", price:1100}],
    P: [{name:"Dart: Ultra-Jugg", price:18740},{name:"Dart: PMFC", price:53700},{name:"Dart: XBM", price:27375},{name:"Boomer: Glaive Lord", price:42100},{name:"Tack: Inferno Ring", price:55500},{name:"Tack: Tack Zone", price:25850},{name:"Glue: Solver", price:31000}],
    M: [{name:"Sniper: Cripple", price:45000},{name:"Sniper: Elite Def", price:17500},{name:"Sub: Commander", price:34000},{name:"Ace: Sky Shredder", price:46100},{name:"Ace: Big Plane", price:102000},{name:"Heli: Apache", price:58000}],
    G: [{name:"Wizard: Archmage", price:42500},{name:"Wizard: POD", price:31800},{name:"Ninja: Grandmaster", price:52000},{name:"Ninja: Master Bomber", price:44000},{name:"Druid: Avatar", price:52000},{name:"Mermonkey: Popseidon", price:48000}],
    S: [{name:"Spike: Perma", price:39500},{name:"Spike: Mines", price:162500},{name:"Engi: Sentry Champ", price:36000},{name:"Beast: PouÄkai", price:48000}]
};

function toggleCoop() {
    const isCoop = document.getElementById('coopToggle').checked;
    document.getElementById('mainBody').classList.toggle('coop-mode', isCoop);
    document.getElementById('modeSubtitle').innerText = isCoop ? "Co-op Mode (2/3 Team Share)" : "Single Player Mode";
    updateUI();
}

function updateUI() {
    const isCoop = document.getElementById('coopToggle').checked;
    const curCash = parseFloat(document.getElementById('curCash').value) || 0;
    const curR = parseInt(document.getElementById('curRound').value) || 6;
    const futR = parseInt(document.getElementById('futRound').value) || 100;

    // Calculate income earned between current and future round
    const totalNewIncome = ROUND_CASH[futR] - ROUND_CASH[curR];
    const myIncomeShare = isCoop ? (totalNewIncome * 0.666) : totalNewIncome;
    const finalProjected = curCash + myIncomeShare;
    
    document.getElementById('projectionDisplay').innerText = `Projected Wallet: $${Math.floor(finalProjected).toLocaleString()}`;

    // Build Math
    const hObj = DATA.heroes[document.getElementById('heroSelect').value];
    const t1 = getTower(document.getElementById('tower1').value);
    const t2 = getTower(document.getElementById('tower2').value);
    const totalCost = hObj.price + t1.price + t2.price;

    document.getElementById('priceReport').innerHTML = `
        <div class="cost-row"><span>${hObj.name}</span><span>$${hObj.price.toLocaleString()}</span></div>
        <div class="cost-row"><span>${t1.name}</span><span>$${t1.price.toLocaleString()}</span></div>
        <div class="cost-row"><span>${t2.name}</span><span>$${t2.price.toLocaleString()}</span></div>
    `;

    const totalBox = document.getElementById('totalDisplay');
    totalBox.innerText = `Total Cost: $${totalCost.toLocaleString()}`;
    totalBox.className = "total-box " + (totalCost > finalProjected ? "over-budget" : "under-budget");
    
    document.getElementById('saveupAdvice').innerHTML = totalCost > finalProjected 
        ? `ðŸš¨ Short by $${Math.floor(totalCost - finalProjected).toLocaleString()}` 
        : `âœ… Affordable with $${Math.floor(finalProjected - totalCost).toLocaleString()} extra!`;
}

function getTower(val) {
    if(!val) return {name:"None", price:0};
    return DATA[val[0]][val.substring(1)] || {name:"None", price:0};
}

function populate() {
    const hSel = document.getElementById('heroSelect');
    DATA.heroes.forEach((h, i) => hSel.add(new Option(`${h.name} ($${h.price})`, i)));
    
    ['tower1', 'tower2'].forEach(id => {
        const s = document.getElementById(id);
        const cats = [{l:"Primary", k:"P"}, {l:"Military", k:"M"}, {l:"Magic", k:"G"}, {l:"Support", k:"S"}];
        cats.forEach(c => {
            const g = document.createElement('optgroup'); g.label = c.l;
            DATA[c.k].forEach((t, i) => g.appendChild(new Option(t.name, c.k + i)));
            s.appendChild(g);
        });
    });
}

function rollRandom() {
    document.getElementById('heroSelect').selectedIndex = Math.floor(Math.random() * DATA.heroes.length);
    const cats = ['P', 'M', 'G', 'S'];
    [1, 2].forEach(num => {
        const c = cats[Math.floor(Math.random() * 4)];
        const i = Math.floor(Math.random() * DATA[c].length);
        document.getElementById('tower' + num).value = c + i;
    });
    updateUI();
}

populate();
updateUI();
</script>
</body>
</html>
